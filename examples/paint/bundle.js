var K={},nt={layout:"row",visible:!0},L=(e,t,n={})=>{K[e]={...nt,...n,component:t}},He=e=>e in K?!0:(console.warn(`control of type "${e}" is requested but not registered`),!1),at=e=>{if(!He(e.type))return;let{component:t,...n}=K[e.type];return n},rt=e=>{if(!He(e.type))return;let{component:t,...n}=K[e.type];return t},Q,y,Me,st,Y,me,Xe,Ye,Fe,ue,se,le,lt,W={},Ue=[],it=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Z=Array.isArray;function z(e,t){for(var n in t)e[n]=t[n];return e}function pe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function ut(e,t,n){var o,r,a,i={};for(a in t)a=="key"?o=t[a]:a=="ref"?r=t[a]:i[a]=t[a];if(arguments.length>2&&(i.children=arguments.length>3?Q.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)i[a]===void 0&&(i[a]=e.defaultProps[a]);return $(e,i,o,r,null)}function $(e,t,n,o,r){var a={type:e,props:t,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++Me,__i:-1,__u:0};return r==null&&y.vnode!=null&&y.vnode(a),a}function F(e){return e.children}function V(e,t){this.props=e,this.context=t}function U(e,t){if(t==null)return e.__?U(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?U(e):null}function Ie(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Ie(e)}}function ge(e){(!e.__d&&(e.__d=!0)&&Y.push(e)&&!O.__r++||me!=y.debounceRendering)&&((me=y.debounceRendering)||Xe)(O)}function O(){for(var e,t,n,o,r,a,i,l=1;Y.length;)Y.length>l&&Y.sort(Ye),e=Y.shift(),l=Y.length,e.__d&&(n=void 0,r=(o=(t=e).__v).__e,a=[],i=[],t.__P&&((n=z({},o)).__v=o.__v+1,y.vnode&&y.vnode(n),ce(t.__P,n,o,t.__n,t.__P.namespaceURI,32&o.__u?[r]:null,a,r??U(o),!!(32&o.__u),i),n.__v=o.__v,n.__.__k[n.__i]=n,je(a,n,i),n.__e!=r&&Ie(n)));O.__r=0}function Re(e,t,n,o,r,a,i,l,p,u,c){var s,_,d,b,v,g,f=o&&o.__k||Ue,m=t.length;for(p=pt(n,t,f,p,m),s=0;s<m;s++)(d=n.__k[s])!=null&&(_=d.__i==-1?W:f[d.__i]||W,d.__i=s,g=ce(e,d,_,r,a,i,l,p,u,c),b=d.__e,d.ref&&_.ref!=d.ref&&(_.ref&&_e(_.ref,null,d),c.push(d.ref,d.__c||b,d)),v==null&&b!=null&&(v=b),4&d.__u||_.__k===d.__k?p=We(d,p,e):typeof d.type=="function"&&g!==void 0?p=g:b&&(p=b.nextSibling),d.__u&=-7);return n.__e=v,p}function pt(e,t,n,o,r){var a,i,l,p,u,c=n.length,s=c,_=0;for(e.__k=new Array(r),a=0;a<r;a++)(i=t[a])!=null&&typeof i!="boolean"&&typeof i!="function"?(p=a+_,(i=e.__k[a]=typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?$(null,i,null,null,null):Z(i)?$(F,{children:i},null,null,null):i.constructor==null&&i.__b>0?$(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):i).__=e,i.__b=e.__b+1,l=null,(u=i.__i=ct(i,n,p,s))!=-1&&(s--,(l=n[u])&&(l.__u|=2)),l==null||l.__v==null?(u==-1&&(r>c?_--:r<c&&_++),typeof i.type!="function"&&(i.__u|=4)):u!=p&&(u==p-1?_--:u==p+1?_++:(u>p?_--:_++,i.__u|=4))):e.__k[a]=null;if(s)for(a=0;a<c;a++)(l=n[a])!=null&&(2&l.__u)==0&&(l.__e==o&&(o=U(l)),$e(l,l));return o}function We(e,t,n){var o,r;if(typeof e.type=="function"){for(o=e.__k,r=0;o&&r<o.length;r++)o[r]&&(o[r].__=e,t=We(o[r],t,n));return t}e.__e!=t&&(t&&e.type&&!n.contains(t)&&(t=U(e)),n.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function ct(e,t,n,o){var r,a,i=e.key,l=e.type,p=t[n];if(p===null&&e.key==null||p&&i==p.key&&l==p.type&&(2&p.__u)==0)return n;if(o>(p!=null&&(2&p.__u)==0?1:0))for(r=n-1,a=n+1;r>=0||a<t.length;){if(r>=0){if((p=t[r])&&(2&p.__u)==0&&i==p.key&&l==p.type)return r;r--}if(a<t.length){if((p=t[a])&&(2&p.__u)==0&&i==p.key&&l==p.type)return a;a++}}return-1}function be(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||it.test(t)?n:n+"px"}function B(e,t,n,o,r){var a,i;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof o=="string"&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||be(e.style,t,"");if(n)for(t in n)o&&n[t]==o[t]||be(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")a=t!=(t=t.replace(Fe,"$1")),i=t.toLowerCase(),t=i in e||t=="onFocusOut"||t=="onFocusIn"?i.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=n,n?o?n.u=o.u:(n.u=ue,e.addEventListener(t,a?le:se,a)):e.removeEventListener(t,a?le:se,a);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function ye(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=ue++;else if(t.t<n.u)return;return n(y.event?y.event(t):t)}}}function ce(e,t,n,o,r,a,i,l,p,u){var c,s,_,d,b,v,g,f,m,N,S,C,P,H,M,A,R,T=t.type;if(t.constructor!=null)return null;128&n.__u&&(p=!!(32&n.__u),a=[l=t.__e=n.__e]),(c=y.__b)&&c(t);e:if(typeof T=="function")try{if(f=t.props,m="prototype"in T&&T.prototype.render,N=(c=T.contextType)&&o[c.__c],S=c?N?N.props.value:c.__:o,n.__c?g=(s=t.__c=n.__c).__=s.__E:(m?t.__c=s=new T(f,S):(t.__c=s=new V(f,S),s.constructor=T,s.render=dt),N&&N.sub(s),s.props=f,s.state||(s.state={}),s.context=S,s.__n=o,_=s.__d=!0,s.__h=[],s._sb=[]),m&&s.__s==null&&(s.__s=s.state),m&&T.getDerivedStateFromProps!=null&&(s.__s==s.state&&(s.__s=z({},s.__s)),z(s.__s,T.getDerivedStateFromProps(f,s.__s))),d=s.props,b=s.state,s.__v=t,_)m&&T.getDerivedStateFromProps==null&&s.componentWillMount!=null&&s.componentWillMount(),m&&s.componentDidMount!=null&&s.__h.push(s.componentDidMount);else{if(m&&T.getDerivedStateFromProps==null&&f!==d&&s.componentWillReceiveProps!=null&&s.componentWillReceiveProps(f,S),!s.__e&&s.shouldComponentUpdate!=null&&s.shouldComponentUpdate(f,s.__s,S)===!1||t.__v==n.__v){for(t.__v!=n.__v&&(s.props=f,s.state=s.__s,s.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(X){X&&(X.__=t)}),C=0;C<s._sb.length;C++)s.__h.push(s._sb[C]);s._sb=[],s.__h.length&&i.push(s);break e}s.componentWillUpdate!=null&&s.componentWillUpdate(f,s.__s,S),m&&s.componentDidUpdate!=null&&s.__h.push(function(){s.componentDidUpdate(d,b,v)})}if(s.context=S,s.props=f,s.__P=e,s.__e=!1,P=y.__r,H=0,m){for(s.state=s.__s,s.__d=!1,P&&P(t),c=s.render(s.props,s.state,s.context),M=0;M<s._sb.length;M++)s.__h.push(s._sb[M]);s._sb=[]}else do s.__d=!1,P&&P(t),c=s.render(s.props,s.state,s.context),s.state=s.__s;while(s.__d&&++H<25);s.state=s.__s,s.getChildContext!=null&&(o=z(z({},o),s.getChildContext())),m&&!_&&s.getSnapshotBeforeUpdate!=null&&(v=s.getSnapshotBeforeUpdate(d,b)),A=c,c!=null&&c.type===F&&c.key==null&&(A=Be(c.props.children)),l=Re(e,Z(A)?A:[A],t,n,o,r,a,i,l,p,u),s.base=t.__e,t.__u&=-161,s.__h.length&&i.push(s),g&&(s.__E=s.__=null)}catch(X){if(t.__v=null,p||a!=null)if(X.then){for(t.__u|=p?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;a[a.indexOf(l)]=null,t.__e=l}else for(R=a.length;R--;)pe(a[R]);else t.__e=n.__e,t.__k=n.__k;y.__e(X,t,n)}else a==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):l=t.__e=_t(n.__e,t,n,o,r,a,i,p,u);return(c=y.diffed)&&c(t),128&t.__u?void 0:l}function je(e,t,n){for(var o=0;o<n.length;o++)_e(n[o],n[++o],n[++o]);y.__c&&y.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(a){a.call(r)})}catch(a){y.__e(a,r.__v)}})}function Be(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Z(e)?e.map(Be):z({},e)}function _t(e,t,n,o,r,a,i,l,p){var u,c,s,_,d,b,v,g=n.props,f=t.props,m=t.type;if(m=="svg"?r="http://www.w3.org/2000/svg":m=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),a!=null){for(u=0;u<a.length;u++)if((d=a[u])&&"setAttribute"in d==!!m&&(m?d.localName==m:d.nodeType==3)){e=d,a[u]=null;break}}if(e==null){if(m==null)return document.createTextNode(f);e=document.createElementNS(r,m,f.is&&f),l&&(y.__m&&y.__m(t,a),l=!1),a=null}if(m==null)g===f||l&&e.data==f||(e.data=f);else{if(a=a&&Q.call(e.childNodes),g=n.props||W,!l&&a!=null)for(g={},u=0;u<e.attributes.length;u++)g[(d=e.attributes[u]).name]=d.value;for(u in g)if(d=g[u],u!="children"){if(u=="dangerouslySetInnerHTML")s=d;else if(!(u in f)){if(u=="value"&&"defaultValue"in f||u=="checked"&&"defaultChecked"in f)continue;B(e,u,null,d,r)}}for(u in f)d=f[u],u=="children"?_=d:u=="dangerouslySetInnerHTML"?c=d:u=="value"?b=d:u=="checked"?v=d:l&&typeof d!="function"||g[u]===d||B(e,u,d,g[u],r);if(c)l||s&&(c.__html==s.__html||c.__html==e.innerHTML)||(e.innerHTML=c.__html),t.__k=[];else if(s&&(e.innerHTML=""),Re(t.type=="template"?e.content:e,Z(_)?_:[_],t,n,o,m=="foreignObject"?"http://www.w3.org/1999/xhtml":r,a,i,a?a[0]:n.__k&&U(n,0),l,p),a!=null)for(u=a.length;u--;)pe(a[u]);l||(u="value",m=="progress"&&b==null?e.removeAttribute("value"):b!=null&&(b!==e[u]||m=="progress"&&!b||m=="option"&&b!=g[u])&&B(e,u,b,g[u],r),u="checked",v!=null&&v!=e[u]&&B(e,u,v,g[u],r))}return e}function _e(e,t,n){try{if(typeof e=="function"){var o=typeof e.__u=="function";o&&e.__u(),o&&t==null||(e.__u=e(t))}else e.current=t}catch(r){y.__e(r,n)}}function $e(e,t,n){var o,r;if(y.unmount&&y.unmount(e),(o=e.ref)&&(o.current&&o.current!=e.__e||_e(o,null,t)),(o=e.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(a){y.__e(a,t)}o.base=o.__P=null}if(o=e.__k)for(r=0;r<o.length;r++)o[r]&&$e(o[r],t,n||typeof e.type!="function");n||pe(e.__e),e.__c=e.__=e.__e=void 0}function dt(e,t,n){return this.constructor(e,n)}function xe(e,t,n){var o,r,a,i;t==document&&(t=document.documentElement),y.__&&y.__(e,t),r=(o=typeof n=="function")?null:n&&n.__k||t.__k,a=[],i=[],ce(t,e=(!o&&n||t).__k=ut(F,null,[e]),r||W,W,t.namespaceURI,!o&&n?[n]:r?null:t.firstChild?Q.call(t.childNodes):null,a,!o&&n?n:r?r.__e:t.firstChild,o,i),je(a,e,i)}Q=Ue.slice,y={__e:function(e,t,n,o){for(var r,a,i;t=t.__;)if((r=t.__c)&&!r.__)try{if((a=r.constructor)&&a.getDerivedStateFromError!=null&&(r.setState(a.getDerivedStateFromError(e)),i=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,o||{}),i=r.__d),i)return r.__E=r}catch(l){e=l}throw e}},Me=0,st=function(e){return e!=null&&e.constructor==null},V.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=z({},this.state),typeof e=="function"&&(e=e(z({},n),this.props)),e&&z(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),ge(this))},V.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ge(this))},V.prototype.render=F,Y=[],Xe=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ye=function(e,t){return e.__v.__b-t.__v.__b},O.__r=0,Fe=/(PointerCapture)$|Capture$/i,ue=0,se=ye(!1),le=ye(!0),lt=0;var ht=0,jt=Array.isArray;function h(e,t,n,o,r,a){t||(t={});var i,l,p=t;if("ref"in p)for(l in p={},t)l=="ref"?i=t[l]:p[l]=t[l];var u={type:e,props:p,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ht,__i:-1,__u:0,__source:r,__self:a};if(typeof e=="function"&&(i=e.defaultProps))for(l in i)p[l]===void 0&&(p[l]=i[l]);return y.vnode&&y.vnode(u),u}var ft=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id];return h("button",{type:"button",onClick:()=>n({[o.id]:{value:!0}},{event:!0}),children:o.text??o.id})};L("button",ft,{label:null});var j,x,re,we,J=0,Ve=[],k=y,ke=k.__b,Ne=k.__r,Se=k.diffed,Ee=k.__c,Ce=k.unmount,Te=k.__;function de(e,t){k.__h&&k.__h(x,e,J||t),J=0;var n=x.__H||(x.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function D(e){return J=1,vt(Oe,e)}function vt(e,t,n){var o=de(j++,2);if(o.t=e,!o.__c&&(o.__=[n?n(t):Oe(void 0,t),function(l){var p=o.__N?o.__N[0]:o.__[0],u=o.t(p,l);p!==u&&(o.__N=[u,o.__[1]],o.__c.setState({}))}],o.__c=x,!x.__f)){var r=function(l,p,u){if(!o.__c.__H)return!0;var c=o.__c.__H.__.filter(function(_){return!!_.__c});if(c.every(function(_){return!_.__N}))return!a||a.call(this,l,p,u);var s=o.__c.props!==l;return c.forEach(function(_){if(_.__N){var d=_.__[0];_.__=_.__N,_.__N=void 0,d!==_.__[0]&&(s=!0)}}),a&&a.call(this,l,p,u)||s};x.__f=!0;var a=x.shouldComponentUpdate,i=x.componentWillUpdate;x.componentWillUpdate=function(l,p,u){if(this.__e){var c=a;a=void 0,r(l,p,u),a=c}i&&i.call(this,l,p,u)},x.shouldComponentUpdate=r}return o.__N||o.__}function I(e,t){var n=de(j++,3);!k.__s&&qe(n.__H,t)&&(n.__=e,n.u=t,x.__H.__h.push(n))}function mt(e){return J=5,gt(function(){return{current:e}},[])}function gt(e,t){var n=de(j++,7);return qe(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function bt(){for(var e;e=Ve.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(q),e.__H.__h.forEach(ie),e.__H.__h=[]}catch(t){e.__H.__h=[],k.__e(t,e.__v)}}k.__b=function(e){x=null,ke&&ke(e)},k.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Te&&Te(e,t)},k.__r=function(e){Ne&&Ne(e),j=0;var t=(x=e.__c).__H;t&&(re===x?(t.__h=[],x.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(q),t.__h.forEach(ie),t.__h=[],j=0)),re=x},k.diffed=function(e){Se&&Se(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Ve.push(t)!==1&&we===k.requestAnimationFrame||((we=k.requestAnimationFrame)||yt)(bt)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),re=x=null},k.__c=function(e,t){t.some(function(n){try{n.__h.forEach(q),n.__h=n.__h.filter(function(o){return!o.__||ie(o)})}catch(o){t.some(function(r){r.__h&&(r.__h=[])}),t=[],k.__e(o,n.__v)}}),Ee&&Ee(e,t)},k.unmount=function(e){Ce&&Ce(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{q(o)}catch(r){t=r}}),n.__H=void 0,t&&k.__e(t,n.__v))};var Le=typeof requestAnimationFrame=="function";function yt(e){var t,n=function(){clearTimeout(o),Le&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,35);Le&&(t=requestAnimationFrame(n))}function q(e){var t=x,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),x=t}function ie(e){var t=x;e.__c=e.__(),x=t}function qe(e,t){return!e||e.length!==t.length||t.some(function(n,o){return n!==e[o]})}function Oe(e,t){return typeof t=="function"?t(e):t}var Pe=e=>e.trim()==="",Ae=e=>isFinite(e),xt=(e,t)=>String(e)!==t,wt=(e,t,n)=>e>=t&&e<=n,kt=(e,t,n)=>Math.min(Math.max(e,t),n),G=({value:e,min:t=-1/0,max:n=1/0,commit:o})=>{let[r,a]=D(String(e)),[i,l]=D(e);I(()=>{a(String(e)),l(e)},[e]);function p(c){let s=String(c);if(a(s),Pe(s))return;let _=Number(s);!Ae(_)||!wt(_,t,n)||xt(_,s)||(l(_),o(_))}function u(){if(Pe(r)||!Ae(Number(r))){a(String(i));return}let c=Number(r),s=kt(c,t,n);a(String(s)),l(s),o(s)}return{value:e,text:r,setValue:p,handleBlur:u}},ee=e=>Array.isArray(e)&&e.every(t=>t!=null&&typeof t=="object"&&!Array.isArray(t)&&"label"in t&&"value"in t)?e:Array.isArray(e)?e.map(t=>({label:String(t),value:t})):e&&typeof e=="object"?Object.entries(e).map(([t,n])=>({label:t,value:n})):[],Nt=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],r=ee(o.options).map(({label:a,value:i},l)=>{let p=o.value===i?"soso-selected":"";return h("button",{onClick:()=>n({[o.id]:{value:i}}),className:`${p}`,type:"button",children:a},a)});return h("div",{className:"soso-buttons",children:r})};L("buttons",Nt,{value:e=>ee(e.options)[0]?.value});var St=e=>"#ffffff",Et=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],[r,a]=D(o.value),[i,l]=D(o.value);I(()=>{a(o.value)},[o.value]);let p=s=>s.startsWith("#")&&s.length===7&&CSS.supports("color",s),u=s=>{let _=s.currentTarget.value,d=p(_)?_:i;n({[o.id]:{value:d}}),a(d)},c=s=>{let _=s.currentTarget.value;p(_)&&(n({[o.id]:{value:_}}),l(_))};return h(F,{children:[h("input",{type:"color",value:r,onInput:c,className:"soso-color-picker"}),h("input",{type:"text",className:"soso-fixed",size:"7",value:r,onInput:c,onChange:u})]})};L("color",Et,{value:St});var Ct=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id];switch(o.format){case"monospace":return h("span",{className:"soso-display soso-monospace",children:o.value});case"block":return h("pre",{className:"soso-display soso-monospace",children:o.value});case"html":return h("span",{className:"soso-display",dangerouslySetInnerHTML:{__html:o.value??""}});default:return h("span",{className:"soso-display",children:o.value})}};L("display",Ct,{value:"",format:"text"});var Tt=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],r=mt(null),[a,i]=D(Array(o.samples).fill(0)),[l,p]=D({min:null,max:null});return I(()=>{i(u=>[...u,o.value].slice(-o.samples)),p(u=>({min:u.min===null?o.value:Math.min(u.min,o.value),max:u.max===null?o.value:Math.max(u.max,o.value)}))},[o]),I(()=>{let u=r.current;if(!u)return;let c=u.getContext("2d"),s=u.getBoundingClientRect(),_=window.devicePixelRatio||1,d=s.width,b=o.height;u.width=d*_,u.height=b*_,c.scale(_,_),u.style.width=d+"px",u.style.height=b+"px",c.clearRect(0,0,d,b);let v=u.closest(".soso-panel"),g=getComputedStyle(v).getPropertyValue("--panel-fg").trim()||"#aaa",f=o.min??l.min??0,m=o.max??l.max??1,N=m-f||1,S=1/(o.samples-1)*d;c.fillStyle=g,c.globalAlpha=.5,c.beginPath(),c.moveTo(0,b),a.forEach((C,P)=>{let H=(C-f)/N*b,M=P*S,A=b-H;c.lineTo(M,A)}),c.lineTo(d,b),c.fill(),c.globalAlpha=1,c.font="10px ui-monospace, monospace",c.textBaseline="top",c.textAlign="left",c.fillText(m,3,0),c.textBaseline="bottom",c.fillText(f,3,b)},[a,l,o]),h("canvas",{className:"soso-graph",ref:r,height:o.height})};L("graph",Tt,{height:60,samples:60});var Je=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id];if(!o.visible)return null;let r=rt(o);if(!r)return null;let a=h(r,{nodes:e,treeNode:t,update:n});if(o.layout==="block")return a;let i=!(o.label===""||o.label===null);return h("div",{className:"soso-row",role:"group","aria-label":o.label??o.id,children:[i&&h("span",{className:"soso-label",children:o.label??o.id}),h("div",{className:"soso-control",children:a})]})},Lt=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],r=t.nodes.map((p,u)=>h(Je,{nodes:e,treeNode:p,update:n},p.id)),a=o.expanded?"soso-expanded":"soso-collapsed",i=o.showLabel?"soso-show-label":"soso-hide-label",l=!(o.label===""||o.label===null);return h("div",{className:`soso-group ${a} ${i}`,children:[l&&h("span",{className:"soso-label",onClick:()=>{o.expandable&&n({[o.id]:{expanded:!o.expanded}})},children:[o.expandable&&h("span",{className:"soso-icon",children:"\u2303"}),o.label??o.id]}),h("div",{className:"soso-container",children:r})]})};L("group",Lt,{layout:"block",expandable:!0,expanded:!0});var Pt=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],{text:r,setValue:a,handleBlur:i}=G({value:o.value,min:o.min,max:o.max,commit:l=>n({[o.id]:{value:l}})});return h("input",{className:"soso-number-input",type:"text",value:r,onInput:l=>a(l.currentTarget.value),onChange:i})};L("number",Pt,{value:()=>0});var ze=(e,t)=>{let n=1/t;return Math.round(e*n)/n},At=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],{x:r,y:a}=o.value,[i,l]=D(!1),[p,u]=D(null),[c,s]=D({height:176,width:176,space:6,radius:2});I(()=>{let v=document.querySelector(".soso-panel");if(!v)return;let g=getComputedStyle(v),f=g.getPropertyValue("--panel-width"),m=g.getPropertyValue("--label-width"),N=g.getPropertyValue("--panel-radius"),S=g.getPropertyValue("--panel-space"),C=parseFloat(f)-parseFloat(m)-2*parseFloat(S),P=parseFloat(N),H=parseFloat(S);s({width:C,height:C,radius:P,space:H})},[]);let _=G({value:o.value.x,min:o.minX,max:o.maxX,commit:v=>n({[o.id]:{value:{...o.value,x:v}}})}),d=G({value:o.value.y,min:o.minY,max:o.maxY,commit:v=>n({[o.id]:{value:{...o.value,y:v}}})});I(()=>{if(!i||!p)return;let v=document.body.style.cursor;document.body.style.cursor="grabbing";let g=N=>{let S=N.clientX??N.touches?.[0]?.clientX,C=N.clientY??N.touches?.[0]?.clientY;if(S===void 0||C===void 0)return;let P=S-p.pointerX,H=C-p.pointerY,M=p.valueX+P*o.scale,A=p.valueY+H*o.scale,R=Math.max(o.minX,Math.min(o.maxX,M)),T=Math.max(o.minY,Math.min(o.maxY,A)),X=ze(R,o.step),ot=ze(T,o.step);n({[o.id]:{value:{x:X,y:ot}}})},f=()=>{l(!1),u(null)},m=N=>(N.preventDefault(),!1);return document.addEventListener("mousemove",g),document.addEventListener("mouseup",f),document.addEventListener("touchmove",g,{passive:!1}),document.addEventListener("touchend",f),()=>{document.body.style.cursor=v,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",f),document.removeEventListener("touchmove",g),document.removeEventListener("touchend",f)}},[i,p,o]);let b=(v,g=null)=>{let f=v.clientX??v.touches?.[0]?.clientX,m=v.clientY??v.touches?.[0]?.clientY;l(!0),u({pointerX:f,pointerY:m,valueX:g?.x??o.value.x,valueY:g?.y??o.value.y})};return h(F,{children:[h("button",{onMouseDown:v=>{v.preventDefault(),b(v)},onTouchStart:v=>{v.preventDefault(),b(v)},className:`soso-translate ${i?"soso-selected":""}`,type:"button",style:{touchAction:"none",userSelect:"none"},children:"\u2316"}),h("input",{className:"soso-number-input soso-fixed",type:"text",size:"7",value:_.text,onInput:v=>_.setValue(v.currentTarget.value),onChange:_.handleBlur}),h("input",{className:"soso-number-input soso-fixed",type:"text",size:"7",value:d.text,onInput:v=>d.setValue(v.currentTarget.value),onChange:d.handleBlur}),i&&h("div",{className:"soso-pad2",children:h("svg",{width:c.width,height:c.height,style:{position:"absolute",top:0,left:0,borderRadius:c.radius},children:[h("rect",{width:c.width,height:c.height,fill:"transparent",className:"soso-border",rx:c.radius}),h("line",{x1:c.width/2,y1:0,x2:c.width/2,y2:c.height,className:"soso-grid"}),h("line",{x1:0,y1:c.height/2,x2:c.width,y2:c.height/2,className:"soso-grid"}),h("text",{x:c.space,y:c.space,className:"soso-label","dominant-baseline":"hanging","font-size":"10",children:[o.minX,",",o.minY]}),h("text",{x:c.width-c.space,y:c.space,"dominant-baseline":"hanging",className:"soso-label","font-size":"10","text-anchor":"end",children:[o.maxX,",",o.minY]}),h("text",{x:c.space,y:c.height-c.space,className:"soso-label","font-size":"10",children:[o.minX,",",o.maxY]}),h("text",{x:c.width-c.space,y:c.height-c.space,className:"soso-label","font-size":"10","text-anchor":"end",children:[o.maxX,",",o.maxY]}),h("circle",{cx:(r-o.minX)/(o.maxX-o.minX)*c.width,cy:(a-o.minY)/(o.maxY-o.minY)*c.height,r:6,className:"soso-indicator"})]})})]})};L("pad2",At,{value:e=>({x:e.minX+(e.maxX-e.minX)*.5,y:e.minY+(e.maxY-e.minY)*.5}),scale:.01,step:.01,minX:-1,maxX:1,minY:-1,maxY:1});var zt=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],{text:r,setValue:a,handleBlur:i}=G({value:o.value,min:o.min,max:o.max,commit:l=>n({[o.id]:{value:l}})});return h(F,{children:[h("input",{type:"range",value:r,min:o.min,max:o.max,step:o.step??1,onInput:l=>a(l.currentTarget.value)}),h("input",{type:"text",size:"7",className:"soso-number-input soso-fixed",value:r,onInput:l=>a(l.currentTarget.value),onChange:i})]})};L("range",zt,{value:e=>e.min??0});var Dt=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],r=ee(o.options),a=p=>{let u=Number(p.currentTarget.value),c=r[u].value;n({[o.id]:{value:c}})},i=r.map(({label:p},u)=>h("option",{value:u,children:p},p)),l=r.findIndex(({value:p})=>p===o.value);return h("select",{value:l<0?"":l,onChange:a,children:i})};L("select",Dt,{value:e=>ee(e.options)[0]?.value});var Ht=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id],r=a=>{n({[o.id]:{value:a.currentTarget.value}})};return o.multiline?h("textarea",{value:o.value,onInput:r,rows:o.rows}):h("input",{type:"text",value:o.value,onInput:r})};L("text",Ht,{value:"",multiline:!1,rows:4});var Mt=({nodes:e,treeNode:t,update:n})=>{let o=e[t.id];return h("input",{type:"checkbox",checked:o.value,onInput:r=>n({[o.id]:{value:r.currentTarget.checked}})})};L("toggle",Mt,{value:e=>!1});var Xt='.soso-panel-container{position:fixed;top:0;right:0}.soso-panel{--panel-bg: hsl(230 7% 10%);--panel-fg: hsl(230 10% 75%);--panel-border: hsl(230 9% 18%);--panel-hover: hsl(230 9% 26%);--panel-pressed: hsl(230 7% 16%);--panel-low-emphasis: hsl(230 4% 55%);--panel-focus: var(--panel-fg);--panel-selection-fg: var(--panel-bg);--panel-selection-bg: var(--panel-fg);--value-number: hsl(220 80% 65%);--value-string: hsl(139 45% 56%);--panel-space: 4px;--panel-radius: 2px;--panel-width: 256px;--label-width: 80px;--row-height: 20px;--font-ui: system-ui, -apple-system, sans-serif;--font-value: ui-monospace, monospace;--font-size-normal: 11px;--line-height-normal: 1.4;--color-link: var(--value-number);--panel-tween-func: cubic-bezier(.25, .8, .5, 1);--panel-tween-duration: .2s;--checkbox-check-width: 3px;--checkbox-check-height: 9px;width:var(--panel-width);color:var(--panel-fg);font-family:var(--font-ui);font-size:var(--font-size-normal);line-height:var(--line-height-normal);box-sizing:border-box;font-variant-numeric:tabular-nums}.soso-panel .soso-row{display:flex;flex-direction:row;gap:var(--panel-space);padding:var(--panel-space) var(--panel-space)}.soso-panel .soso-row+.soso-row{padding-top:calc(var(--panel-space) * .5)}.soso-panel .soso-row:has(+.soso-row){padding-bottom:calc(var(--panel-space) * .5)}.soso-panel .soso-container .soso-container{border-bottom:1px solid var(--panel-border)}.soso-panel .soso-row .soso-label{display:flex;align-self:flex-start;align-items:center;line-height:1.2;min-height:20px;min-width:0;user-select:none;color:var(--panel-low-emphasis);flex:0 0 var(--label-width)}.soso-panel .soso-group{display:flex;flex-direction:column;background:var(--panel-bg);border-radius:var(--panel-radius)}.soso-panel-container>.soso-panel>.soso-group>.soso-label{border-radius:0 0 var(--panel-radius) var(--panel-radius)}.soso-panel .soso-group>.soso-label{display:flex;align-items:center;user-select:none;background:var(--panel-border);border-radius:var(--panel-radius);height:var(--row-height);padding-left:var(--panel-space);gap:var(--panel-space)}.soso-panel .soso-group>.soso-label:has(>.soso-icon){cursor:pointer}.soso-panel .soso-group>.soso-label>.soso-icon{font-weight:700;font-size:10px;cursor:pointer}@media (prefers-reduced-motion: no-preference){.soso-panel .soso-group>.soso-label>.soso-icon{transition:transform var(--panel-tween-duration) var(--panel-tween-func)}}.soso-panel .soso-group.soso-expanded>.soso-label>.soso-icon{transform:rotate(180deg)}.soso-panel .soso-group>.soso-container{flex-direction:column;overflow:hidden;display:none}.soso-panel .soso-group.soso-expanded>.soso-container{display:flex}@supports (interpolate-size: allow-keywords){.soso-panel .soso-group>.soso-container{display:flex;interpolate-size:allow-keywords;height:0;opacity:0}@media (prefers-reduced-motion: no-preference){.soso-panel .soso-group>.soso-container{transition:height var(--panel-tween-duration) var(--panel-tween-func),padding var(--panel-tween-duration) var(--panel-tween-func),opacity var(--panel-tween-duration) var(--panel-tween-func)}}.soso-panel .soso-group.soso-expanded>.soso-container{height:auto;opacity:1}}.soso-panel-container>.soso-panel{border-radius:0 0 var(--panel-radius) var(--panel-radius)}.soso-panel .soso-row .soso-control{flex:1 1 auto;display:flex;justify-content:flex-start;align-items:center;min-height:var(--row-height);gap:var(--panel-space)}.soso-panel button,.soso-panel input,.soso-panel select,.soso-panel textarea{font-size:inherit;font-family:inherit;width:100%;box-sizing:border-box;border:1px solid transparent;padding:0 var(--panel-space);border-radius:var(--panel-radius);background:var(--panel-border);color:var(--panel-fg)}.soso-panel button,.soso-panel select,.soso-panel input[type=text],.soso-panel input[type=range]{min-height:var(--row-height)}.soso-panel input[type=color]{height:var(--row-height)}.soso-panel button,.soso-panel select,.soso-panel input[type=checkbox],.soso-panel input[type=range],.soso-panel input[type=color]{cursor:pointer}.soso-panel input[type=text],.soso-panel textarea{cursor:text}.soso-panel button:focus-visible,.soso-panel select:focus-visible,.soso-panel input:focus-visible,.soso-panel textarea:focus-visible{outline:2px solid var(--panel-focus);outline-offset:0px}.soso-panel button:focus:not(:focus-visible),.soso-panel select:focus:not(:focus-visible),.soso-panel input:focus:not(:focus-visible),.soso-panel textarea:focus:not(:focus-visible){outline:none}.soso-panel button:hover:not(:active):not(.soso-selected),.soso-panel input:hover,.soso-panel select:hover,.soso-panel textarea:hover{background:var(--panel-hover)}.soso-panel button:active,.soso-panel button.soso-selected{background:var(--panel-fg);color:var(--panel-bg);border-radius:var(--panel-radius)}.soso-panel input::selection,.soso-panel textarea::selection{background:var(--panel-selection-bg);color:var(--panel-selection-fg)}.soso-panel textarea{resize:vertical;min-height:calc(var(--row-height) * 2 + var(--panel-space));line-height:var(--line-height-normal);color:var(--value-string);font-family:var(--font-value)}.soso-panel .soso-buttons{display:flex;flex-direction:row;flex:1;gap:var(--panel-space)}.soso-panel .soso-pad2{position:absolute;align-self:flex-start;margin-top:calc(var(--row-height) + var(--panel-space));width:calc(var(--panel-width) - var(--label-width) - 2 * var(--panel-space));height:calc(var(--panel-width) - var(--label-width) - 2 * var(--panel-space));background:var(--panel-bg);z-index:1001}.soso-panel .soso-pad2 .soso-border,.soso-panel .soso-pad2 .soso-grid{stroke:var(--panel-fg);stroke-opacity:.25}.soso-panel .soso-pad2 .soso-label{fill:var(--panel-fg);opacity:.5}.soso-panel .soso-pad2 .soso-indicator{fill:var(--panel-fg)}.soso-panel button.soso-translate{font-weight:bolder}.soso-panel button.soso-translate.soso-selected{cursor:grabbing}.soso-panel input[type=text]{color:var(--value-string);font-family:var(--font-value)}.soso-panel input[type=text].soso-number-input{color:var(--value-number)}.soso-panel input[type=number]::-webkit-inner-spin-button,.soso-panel input[type=number]::-webkit-outer-spin-button{appearance:none;margin:0}.soso-panel input[type=text].soso-fixed{width:60px}.soso-panel .soso-control>.soso-display{line-height:var(--row-height)}.soso-panel .soso-control>.soso-display.soso-monospace{font-family:var(--font-value)}.soso-panel .soso-display a{color:var(--color-link);text-decoration:underline}.soso-panel .soso-display a:hover{text-decoration:none}.soso-panel pre.soso-display{margin:0}.soso-panel input[type=checkbox]{margin:0;appearance:none;border-radius:var(--panel-radius);width:14px;height:14px;text-align:center}.soso-panel input[type=checkbox]:checked:before{content:"";display:flex;height:var(--checkbox-check-height);width:var(--checkbox-check-width);border-bottom:2px solid var(--panel-fg);border-right:2px solid var(--panel-fg);transform:rotate(45deg)}.soso-panel input[type=range]{-webkit-appearance:none;appearance:none;background:transparent;margin:0;padding:0}.soso-panel input[type=range]::-webkit-slider-runnable-track{background:var(--panel-border);height:3px;border-radius:2px;margin:0 -1px}.soso-panel input[type=range]::-moz-range-track{background:var(--panel-border);height:3px;border-radius:2px;margin:0 -1px}.soso-panel input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;border-radius:var(--panel-radius);background:var(--panel-fg);margin-top:-4px}.soso-panel input[type=range]::-moz-range-thumb{width:12px;height:12px;border-radius:var(--panel-radius);background:var(--panel-fg);border:none}.soso-panel input[type=color]{-webkit-appearance:none;border:1px solid var(--panel-border);padding:0;border-radius:var(--panel-radius);height:var(--row-height)}.soso-panel input[type=color]::-webkit-color-swatch-wrapper{padding:0}.soso-panel input[type=color]::-webkit-color-swatch{border:0}.soso-panel canvas.soso-graph{width:100%}',Yt=0,Ft=e=>`node ${Yt++}`,Ge=e=>{let{id:t=Ft(),nodes:n=[],...o}=e,r={},a={id:t,nodes:[]},i={id:t},l=at(e);for(let p in l)typeof l[p]=="function"?i[p]=l[p]({...l,...e}):i[p]=l[p];return Object.assign(i,o),r[t]=i,n.length>0&&n.forEach(p=>{let[u,c]=Ge(p);Object.assign(r,u),a.nodes.push(c)}),[r,a]},Ut=()=>{let e=document.createElement("div");return e.classList.add("soso-panel-container"),document.body.append(e),e},It=()=>{if(!document.querySelector("style[data-soso-panel]")){let e=document.createElement("style");e.textContent=Xt,e.setAttribute("data-soso-panel","true"),document.head.appendChild(e)}},De=Symbol("all"),Rt=class{constructor(e,t){let[n,o]=Ge(e);this.nodes=n,this.root=o,this.container=t.mount??Ut(),this.options=t,this.subscribers=new Map,this.raf=null,t.injectStyles&&It(),this.render()}render(){let e=()=>{xe(h("div",{className:`soso-panel ${this.options.classNames.join(" ")}`,children:h(Je,{nodes:this.nodes,treeNode:this.root,update:this.handleUpdate.bind(this)})}),this.container)};if(!this.options.throttleRendering){e();return}this.options.throttleRendering&&!this.raf&&(this.raf=requestAnimationFrame(()=>{e(),this.raf=null}))}handleUpdate(e,{silent:t=!1,event:n=!1}={}){if(typeof e!="object"){console.warn("could not set values: invalid values object");return}for(let o in e){let r=this.nodes[o];if(!r)continue;let a=e[o];n||(this.nodes[o]={...r,...a}),"value"in a&&!t&&this.notifySubscribers(o,e[o].value)}this.render()}notifySubscribers(e,t){this.subscribers.get(e)?.forEach(n=>n(t)),this.subscribers.get(De)?.forEach(n=>n(e,t))}subscribe(e,t){let n=typeof e=="string"?e:De,o=typeof t=="function"?t:typeof e=="function"?e:void 0;if(o===void 0){console.warn("could not subscribe: no handler");return}return this.subscribers.has(n)||this.subscribers.set(n,[]),this.subscribers.get(n).push(o),()=>{let r=this.subscribers.get(n),a=r.indexOf(o);a>-1?r.splice(a,1):console.warn("could not unsubscribe: could not find handler")}}set(e,t){let n={};for(let o in e)n[o]={value:e[o]};this.handleUpdate(n,t)}update(e,t){this.handleUpdate(e,{...t,event:!1})}get(){let e={};for(let t in this.nodes){let n=this.nodes[t]?.value;n!==void 0&&(e[t]=n)}return e}destroy(){this.raf&&cancelAnimationFrame(this.raf),xe(null,this.container),this.options.mount||this.container.remove(),this.subscribers.clear(),this.values={}}},Ke={create(e,t={}){let n=Array.isArray(e)?{type:"group",label:"controls",nodes:e}:e,o=new Rt(n,{throttleRendering:!0,injectStyles:!0,classNames:[],...t});return{subscribe:o.subscribe.bind(o),update:o.update.bind(o),set:o.set.bind(o),get:o.get.bind(o),destroy:o.destroy.bind(o)}}};var ne=Ke.create({id:"paint",type:"group",nodes:[{id:"tool",type:"buttons",value:"brush",options:["brush","eraser"]},{id:"size",type:"range",value:20,min:1,max:100},{id:"color",type:"color",value:"#0066FF"},{id:"opacity",type:"range",value:1,min:0,max:1,step:.01},{id:"pressure",type:"toggle",label:"pressure",value:!0},{id:"clear",type:"button",text:"clear canvas"},{id:"save",type:"button",text:"save image"}]}),w=document.createElement("canvas"),E=w.getContext("2d"),Qe=document.getElementById("prompt");document.body.appendChild(w);w.width=window.innerWidth;w.height=window.innerHeight;w.style.cursor="crosshair";var ve=!1,te=0,oe=0,he=0,fe=0,Wt=()=>Qe&&Qe.remove(),Ze=e=>{if(e.touches&&e.touches.length>0){let t=w.getBoundingClientRect();return{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}return{x:e.offsetX,y:e.offsetY}},et=e=>{Wt(),ve=!0;let t=Ze(e);[te,oe]=[t.x,t.y],he=Date.now();let{size:n}=ne.get();fe=n},tt=e=>{if(!ve)return;e.preventDefault();let t=Ze(e),{tool:n,size:o,color:r,opacity:a,pressure:i}=ne.get(),l=o;if(i&&n!=="eraser"){let p=Date.now(),u=p-he,s=Math.sqrt(Math.pow(t.x-te,2)+Math.pow(t.y-oe,2))/(u+1),_=o*Math.max(.3,Math.min(1,2/(s+.5)));l=fe*.7+_*.3,fe=l,he=p}E.globalAlpha=a,E.lineWidth=l,E.lineCap="round",E.lineJoin="round",n==="eraser"?E.globalCompositeOperation="destination-out":(E.globalCompositeOperation="source-over",E.strokeStyle=r),E.beginPath(),E.moveTo(te,oe),E.lineTo(t.x,t.y),E.stroke(),[te,oe]=[t.x,t.y]},ae=()=>{ve=!1};w.addEventListener("mousedown",et);w.addEventListener("mousemove",tt);w.addEventListener("mouseup",ae);w.addEventListener("mouseout",ae);w.addEventListener("touchstart",et,{passive:!1});w.addEventListener("touchmove",tt,{passive:!1});w.addEventListener("touchend",ae);w.addEventListener("touchcancel",ae);ne.subscribe("clear",()=>{E.clearRect(0,0,w.width,w.height)});ne.subscribe("save",()=>{let e=document.createElement("a");e.download="soso-drawing.png",e.href=w.toDataURL(),e.click()});window.addEventListener("resize",()=>{let e=E.getImageData(0,0,w.width,w.height);w.width=window.innerWidth,w.height=window.innerHeight,E.putImageData(e,0,0)});
